<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="../images/pitss.jpg" type="image/x-icon">
  <title>Panel Admin - Pitts Bowling</title>
  <link rel="stylesheet" href="admin.css">
  <link rel="stylesheet" href="../css/general.css">
  <link rel="stylesheet" href="admin-news.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

  <main>
    <h1>Panel de Administraci√≥n</h1>

    <!-- Tabs de navegaci√≥n -->
    <div class="tabs">
      <button class="tab-button active" data-tab="foods">üçî Comidas</button>
      <button class="tab-button" data-tab="categories">üìÇ Categor√≠as</button>
      <button class="tab-button" data-tab="extras">‚ûï Extras</button>
      <button class="tab-button" data-tab="invoices">üßæ Facturas <span id="invoices-badge"
          class="admin-tab-badge hidden"></span></button>
      <button class="tab-button" data-tab="reservations">üìã Reservas <span id="reservations-badge"
          class="admin-tab-badge hidden"></span></button>
      <button class="tab-button" data-tab="packages">üì¶ Paquetes</button>
      <button class="tab-button" data-tab="lanes">üé≥ Pistas</button>
      <button class="tab-button" data-tab="posts">üì∞ Noticias</button>
      <button class="tab-button" data-tab="config">‚öôÔ∏è Configuraci√≥n</button>
    </div>

    <!-- Secci√≥n Comidas -->
    <div class="tab-content active" id="foods">
      <h2>Gestionar Comidas</h2>
      <form id="foodForm" enctype="multipart/form-data">
        <input type="hidden" id="food-id" name="id">

        <label for="food-name">Nombre:</label>
        <input type="text" id="food-name" name="name" required>

        <label for="food-description">Descripci√≥n:</label>
        <textarea id="food-description" name="description" required></textarea>

        <label for="food-image">Imagen:</label>
        <input type="file" id="food-image" name="image" accept="image/*">

        <div id="sizes-container">
          <h4>Tama√±os, Calor√≠as y Precios</h4>
          <button type="button" id="add-size-btn">‚ûï Agregar Tama√±o</button>
          <div id="sizes-list"></div>
        </div>

        <label for="food-category">Categor√≠a:</label>
        <select id="food-category" name="category_id" required></select>

        <label for="food-featured" style="display:flex; align-items:center; gap:8px; margin-top:8px;">
          <input type="checkbox" id="food-featured" name="is_featured">
          Destacada (aparecer√° en destacados)
        </label>

        <button type="submit">Guardar</button>

      </form>

      <h3>Lista de comidas</h3>
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Categor√≠a</th>
            <th>Tama√±os</th>
            <th>Imagen</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="foodTableBody"></tbody>
      </table>
    </div>

    <!-- Secci√≥n Categor√≠as -->
    <div class="tab-content" id="categories">
      <h2>Gestionar Categor√≠as</h2>
      <form id="categoryForm">
        <input type="hidden" id="category-id" name="id">

        <label for="category-name">Nombre:</label>
        <input type="text" id="category-name" name="name" required>

        <label for="category-image">Imagen (Opcional):</label>
        <input type="file" id="category-image" name="image" accept="image/*">

        <label for="category-featured" style="display:flex; align-items:center; gap:8px;">
          <input type="checkbox" id="category-featured" name="is_featured">
          Destacada (aparece primero y con estilo)
        </label>

        <button type="submit">Guardar</button>
      </form>

      <h3>Lista de categor√≠as</h3>
      <table>
        <thead>
          <tr>
            <th>Imagen</th>
            <th>Nombre</th>
            <th>Destacada</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="categoryTableBody"></tbody>
      </table>
    </div>

    <!-- Secci√≥n Extras -->
    <div class="tab-content" id="extras">
      <h2>Gestionar Extras</h2>
      <form id="extraForm">
        <input type="hidden" id="extra-id" name="id">

        <label for="extra-name">Nombre:</label>
        <input type="text" id="extra-name" name="name" required>

        <label for="extra-price">Precio:</label>
        <input type="number" id="extra-price" name="price" step="0.01" required>

        <button type="submit">Guardar</button>
      </form>

      <h3>Lista de extras</h3>
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Precio</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="extraTableBody"></tbody>
      </table>
    </div>

    <!-- Secci√≥n Facturas -->
    <div class="tab-content" id="invoices">
      <h2>Facturas</h2>

      <div class="invoices-controls">
        <div class="invoices-tabs">
          <button id="tab-pending" class="invoice-tab active" data-filter="pendiente">‚è≥ Pendientes</button>
          <button id="tab-done" class="invoice-tab" data-filter="pagada">‚úÖ Finalizadas</button>
        </div>

        <div style="margin-top:10px;">
          <input id="invoice-search" placeholder="Buscar por id o usuario..." style="padding:6px; width:280px;">
          <button id="refresh-invoices" style="margin-left:6px;">üîÑ Refrescar</button>
        </div>
      </div>

      <div id="invoices-list" style="margin-top:12px;">
        <!-- Lista de facturas renderizada por JS -->
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th>ID</th>
              <th>Cliente</th>
              <th>Fecha</th>
              <th>Total</th>
              <th>M√©todo</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="invoicesTableBody"></tbody>
        </table>
      </div>

      <!-- Modal detalle factura -->
      <section id="invoice-detail" class="detalle hidden" style="position:fixed; inset:0; z-index:9999; display:block;">
        <div id="invoice-detail-inner"
          style="background:#fff; padding:16px; width:920px; max-width:95%; max-height:90%; overflow:auto; box-shadow:0 8px 30px rgba(0,0,0,0.25); border-radius:8px; margin:40px auto; position:relative;">
          <button id="close-invoice-detail" style="position:absolute; right:12px; top:8px;">‚úï</button>
          <h3>Factura #<span id="inv-id"></span></h3>
          <p><strong>Cliente:</strong> <span id="inv-cliente-name"></span></p>
          <p><strong>Correo:</strong> <span id="inv-cliente-email"></span></p>
          <p><strong>Fecha:</strong> <span id="inv-date"></span></p>

          <p>
            <strong>M√©todo:</strong> <span id="inv-payment-method" style="text-transform: capitalize;"></span>

            &nbsp;&nbsp;|&nbsp;&nbsp; <label><strong>Estado:</strong>
              <select id="inv-status" style="padding: 4px;">
                <option value="pendiente">Pendiente</option>
                <option value="pagada">Finalizada</option>
                <option value="anulada">Anulada</option>
              </select>
            </label>
          </p>

          <p>
            <label>Descripci√≥n del pago (admin):</label><br>
            <textarea id="inv-payment-desc" rows="3" style="width:100%;"></textarea>
            <!-- Contenedor para botones de mapas -->
          <div id="inv-map-links" style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap;"></div>
          </p>

          <div
            style="text-align:center; background:#f9f9f9; padding:10px; border-radius:8px; margin-bottom:15px; border:1px solid #eee;">
            <h4>Comprobante de Pago</h4>
            <img id="inv-capture" src="" alt="Sin comprobante" class="zoomable-image"
              style="max-width:100%; max-height:250px; cursor:pointer; border-radius:4px;">
            <p id="inv-no-capture" style="color:#888; display:none;">No se adjunt√≥ imagen</p>
          </div>

          <h4>Detalles</h4>
          <div id="inv-details-container"
            style="max-height:320px; overflow:auto; border:1px solid #eee; padding:8px; border-radius:6px;"></div>


          <p style="margin-top:12px;">
            <strong>Total:</strong> $<span id="inv-total"></span>
          </p>

          <div style="display:flex; gap:8px; margin-top:10px;">
            <button id="save-invoice-changes">üíæ Guardar cambios</button>
            <button id="delete-invoice" style="background:#e74c3c; color:#fff;">üóëÔ∏è Eliminar factura</button>
            <button id="close-invoice" style="margin-left:auto;">Cerrar</button>
          </div>
        </div>
      </section>

    </div>

    <!-- Seccion del gestor de reservas -->

    <div class="tab-content" id="reservations">
      <h2>Gesti√≥n de Reservas</h2>

      <div class="invoices-controls">
        <div class="invoices-tabs">
          <button id="res-tab-pending" class="invoice-tab active">‚è≥ Pendientes</button>
          <button id="res-tab-confirmed" class="invoice-tab">‚úÖ Confirmadas</button>
          <button id="res-tab-all" class="invoice-tab">üìÇ Todas</button>
        </div>

        <div style="margin-top:10px;">
          <input id="reservation-search" placeholder="Buscar por ref o cliente..." style="padding:6px; width:280px;">
          <button id="refresh-reservations" style="margin-left:6px;">üîÑ Refrescar</button>
        </div>
      </div>

      <div style="margin-top:12px;">
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th>ID</th>
              <th>Cliente</th>
              <th>Fecha Juego</th>
              <th>Paquete</th>
              <th>Pista</th>
              <th>Total</th>
              <th>Metodo de pago</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="reservationsTableBody"></tbody>
        </table>
      </div>

      <section id="reservation-detail" class="detalle hidden"
        style="position:fixed; inset:0; z-index:9999; display:none;">
        <div
          style="background:#fff; padding:16px; width:920px; max-width:95%; max-height:90%; overflow:auto; box-shadow:0 8px 30px rgba(0,0,0,0.25); border-radius:8px; margin:40px auto; position:relative;">
          <button id="close-reservation-detail" style="position:absolute; right:12px; top:8px;">‚úï</button>

          <h3>Reserva #<span id="dt-res-id"></span></h3>

          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
            <div>
              <p><strong>Cliente:</strong> <span id="dt-res-user"></span></p>
              <p><strong>Correo:</strong> <span id="dt-res-email"></span></p>
              <p><strong>Paquete:</strong> <span id="dt-res-package"></span></p>
              <p><strong>Inicio:</strong> <span id="dt-res-start"></span></p>
              <p><strong>Fin:</strong> <span id="dt-res-end"></span></p>
              <p><strong>Personas:</strong> <span id="dt-res-people"></span></p>
              <p><strong>Pistas asignadas:</strong> <span id="dt-res-lanes"></span></p>
              <p><strong>Tallas:</strong> <span id="dt-res-shoes"></span></p>
              <hr>
              <p><strong>Total a Pagar:</strong> $<span id="dt-res-total"></span></p>
              <p><strong>M√©todo:</strong> <span id="dt-res-method"></span></p>
              <p><strong>Referencia:</strong> <span id="dt-res-ref"></span></p>

              <label><strong>Estado:</strong>
                <select id="dt-res-status-select" style="margin-top:5px; width:100%; padding:5px;">
                  <option value="pending">Pendiente</option>
                  <option value="confirmed">Confirmada</option>
                  <option value="cancelled">Cancelada / Rechazada</option>
                  <option value="completed">Completada</option>
                </select>
              </label>

              <label style="margin-top:10px; display:block;"><strong>Notas Admin:</strong>
                <textarea id="dt-res-notes" rows="3" style="width:100%;"></textarea>
              </label>
            </div>

            <div style="text-align:center; background:#f9f9f9; padding:10px; border-radius:8px;">
              <h4>Comprobante de Pago</h4>
              <img id="dt-res-capture" src="" alt="Sin comprobante"
                style="max-width:100%; max-height:400px; border:1px solid #ddd;">
              <p id="no-capture-text" style="color:red; display:none;">No se adjunt√≥ imagen</p>
            </div>
          </div>

          <div style="display:flex; gap:8px; margin-top:20px; border-top:1px solid #eee; padding-top:10px;">
            <button id="save-res-changes">üíæ Actualizar Estado</button>
            <button id="delete-res" style="background:#e74c3c; color:#fff;">üóëÔ∏è Eliminar Reserva</button>
            <button id="close-res-btn" style="margin-left:auto;">Cerrar</button>
          </div>
        </div>
      </section>
    </div>

    <div class="tab-content" id="packages">
      <h2>Gestionar Paquetes</h2>
      <form id="packageForm" enctype="multipart/form-data">
        <input type="hidden" id="pkg-id" name="id">

        <label>Nombre del Paquete:</label>
        <input type="text" id="pkg-name" name="name" required>

        <label>Descripci√≥n:</label>
        <textarea id="pkg-desc" name="description" required></textarea>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
          <div>
            <label>Precio ($):</label>
            <input type="number" id="pkg-price" name="price" step="0.01" required>
          </div>
          <div>
            <label>Duraci√≥n (horas):</label>
            <input type="number" id="pkg-duration" name="duration" step="0.5" required>
          </div>
        </div>

        <label>M√°ximo de personas:</label>
        <input type="number" id="pkg-max" name="max_people" required>

        <label>Imagen:</label>
        <input type="file" id="pkg-image" name="image" accept="image/*">

        <label style="display:flex; align-items:center; gap:8px; margin-top:8px;">
          <input type="checkbox" id="pkg-active" name="active" checked>
          Paquete Activo (Visible al usuario)
        </label>

        <button type="submit">Guardar Paquete</button>
      </form>

      <h3>Lista de Paquetes</h3>
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Precio</th>
            <th>Horas</th>
            <th>Max Pers.</th>
            <th>Activo</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="packagesTableBody"></tbody>
      </table>
    </div>

    <div class="tab-content" id="lanes">
      <h2>Gestionar Pistas</h2>
      <form id="laneForm">
        <input type="hidden" id="lane-id" name="id">

        <label>N√∫mero de Pista:</label>
        <input type="number" id="lane-number" name="lane_number" required>

        <label>Nombre (ej: Pista VIP):</label>
        <input type="text" id="lane-name" name="name" required>

        <label>Descripci√≥n:</label>
        <textarea id="lane-desc" name="description"></textarea>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
          <div>
            <label>Precio por Hora ($):</label>
            <input type="number" id="lane-price" name="price" step="0.01" required>
          </div>
          <div>
            <label>Max Jugadores:</label>
            <input type="number" id="lane-max" name="max_players" value="6" required>
          </div>
        </div>

        <label style="display:flex; align-items:center; gap:8px; margin-top:8px;">
          <input type="checkbox" id="lane-active" name="active" checked>
          Pista Activa
        </label>

        <button type="submit">Guardar Pista</button>
      </form>

      <h3>Lista de Pistas</h3>
      <table>
        <thead>
          <tr>
            <th>N¬∞</th>
            <th>Nombre</th>
            <th>Precio/Hora</th>
            <th>Activa</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="lanesTableBody"></tbody>
      </table>
    </div>

    <!-- Secci√≥n Noticias -->
    <div class="tab-content" id="posts">
      <h2>Gestionar Noticias</h2>
      <form id="postForm" enctype="multipart/form-data">
        <input type="hidden" id="post-id">

        <div style="display:grid; grid-template-columns: 2fr 1fr; gap:20px;">
          <!-- Columna Izquierda: Datos Principales -->
          <div style="display:flex; flex-direction:column; gap:15px;">
            <div>
              <label>T√≠tulo de la Noticia:</label>
              <input type="text" id="post-title" required style="font-size:1.1rem; padding:10px;">
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
              <div>
                <label>Categor√≠a:</label>
                <select id="post-category" required style="padding:10px;">
                  <option value="tecnicas">Tips & T√©cnicas</option>
                  <option value="eventos">Eventos</option>
                  <option value="noticias">Noticias</option>
                  <option value="torneos">Torneos</option>
                </select>
              </div>
              <div>
                <label>Tags (separadas por coma):</label>
                <input type="text" id="post-tags" placeholder="ej: torneo, parejas, 2026" style="padding:10px;">
              </div>
            </div>

            <div>
              <label>Contenido:</label>
              <textarea id="post-content" rows="12" placeholder="Escribe aqu√≠ el contenido de la noticia..."
                required></textarea>
            </div>
          </div>

          <!-- Columna Derecha: Multimedia y Opciones -->
          <div style="display:flex; flex-direction:column; gap:20px;">

            <div class="upload-zone">
              <label>Imagen Principal (Portada):</label>
              <div class="file-upload-wrapper" id="main-image-wrapper">
                <input type="file" id="post-main-image-file" accept="image/*,video/*">
                <div class="upload-placeholder">
                  <span style="font-size:2rem;"><i class="fa-solid fa-camera"></i></span>
                  <span>Click para subir portada</span>
                </div>
                <div id="post-main-image-preview"></div>
              </div>
            </div>

            <div class="upload-zone">
              <label>Galer√≠a de Im√°genes/Videos:</label>
              <div class="file-upload-wrapper" id="gallery-wrapper">
                <input type="file" id="post-gallery-files" accept="image/*,video/*" multiple>
                <div class="upload-placeholder">
                  <span style="font-size:2rem;"><i class="fa-solid fa-images"></i></span>
                  <span>Click para agregar fotos</span>
                </div>
                <div id="post-gallery-preview"></div>
              </div>
            </div>

            <div
              style="background:#f1f5f9; padding:15px; border-radius:8px; display:flex; flex-direction:column; gap:10px;">
              <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                <input type="checkbox" id="post-featured" style="width:20px; height:20px;">
                <span style="font-weight:bold; color:#d97706;">‚òÖ Destacar Noticia</span>
              </label>

              <div>
                <label style="font-size:0.85rem;">Enlace Externo (Opcional):</label>
                <input type="url" id="post-social-link" placeholder="https://instagram.com/..."
                  style="font-size:0.9rem;">
              </div>

              <div>
                <label style="font-size:0.85rem;">Fecha Publicaci√≥n (Opcional):</label>
                <input type="datetime-local" id="post-published" style="font-size:0.9rem;">
              </div>
            </div>

          </div>
        </div>

        <div style="margin-top:25px; display:flex; gap:15px; justify-content: flex-end;">
          <button type="button" id="post-reset" style="padding:12px 24px;">Limpiar / Nuevo</button>
          <button type="submit" style="padding:12px 30px; font-weight:bold; font-size:1.1rem;">üíæ Guardar
            Noticia</button>
        </div>
      </form>

      <h3>Lista de Noticias</h3>
      <table>
        <thead>
          <tr>
            <th>T√≠tulo</th>
            <th>Categor√≠a</th>
            <th>Publicado</th>
            <th>Destacado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="postsTableBody"></tbody>
      </table>
      </table>
    </div>

    <!-- Secci√≥n Configuraci√≥n -->
    <div class="tab-content" id="config">
      <h2>Configuraci√≥n General</h2>
      <div class="card"
        style="max-width: 500px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h3>Tasa BCV ($ -> Bs)</h3>
        <form id="configForm">
          <div style="margin-bottom: 15px;">
            <label for="config-tasa" style="display: block; margin-bottom: 5px; font-weight: bold;">Tasa Actual
              (Bs/$):</label>
            <input type="number" id="config-tasa" name="tasa" step="0.01" required
              style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px;">
          </div>
          <button type="submit"
            style="width: 100%; padding: 10px; background: #2ecc71; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">üíæ
            Actualizar Tasa</button>
        </form>
        <p style="margin-top: 10px; color: #666; font-size: 14px;">Esta tasa se actualizar√° autom√°ticamente en el men√∫
          p√∫blico para los c√°lculos de pago m√≥vil y transferencia.</p>
      </div>

      <div class="card"
        style="max-width: 500px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 20px;">
        <h3>Configuraci√≥n de Delivery</h3>
        <form id="deliveryConfigForm">
          <div style="margin-bottom: 15px;">
            <label for="del-km-base" style="display: block; margin-bottom: 5px; font-weight: bold;">Rango Base
              (Km):</label>
            <input type="number" id="del-km-base" name="km_base" step="0.1" required
              style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px;"
              title="Distancia inicial con precio fijo">
          </div>
          <div style="margin-bottom: 15px;">
            <label for="del-precio-base" style="display: block; margin-bottom: 5px; font-weight: bold;">Precio Base
              ($):</label>
            <input type="number" id="del-precio-base" name="precio_base" step="0.01" required
              style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px;"
              title="Costo m√≠nimo del envio">
          </div>
          <div style="margin-bottom: 15px;">
            <label for="del-precio-km" style="display: block; margin-bottom: 5px; font-weight: bold;">Precio por Km
              Extra ($):</label>
            <input type="number" id="del-precio-km" name="precio_km" step="0.01" required
              style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px;"
              title="Costo adicional por cada Km fuera del rango base">
          </div>
          <div style="margin-bottom: 15px;">
            <label for="del-distancia-max" style="display: block; margin-bottom: 5px; font-weight: bold;">Distancia
              M√°xima (Km):</label>
            <input type="number" id="del-distancia-max" name="distancia_max" step="0.1" required
              style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px;"
              title="Radio m√°ximo de cobertura">
          </div>
          <button type="submit"
            style="width: 100%; padding: 10px; background: #3498db; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">üíæ
            Guardar Configuraci√≥n</button>
        </form>
        <p style="margin-top: 10px; color: #666; font-size: 14px;">Estos valores se usan para calcular el costo de env√≠o
          autom√°ticamente.</p>
      </div>
    </div>

    <div id="lightbox-overlay" class="hidden">
      <span id="lightbox-close">&times;</span>
      <img id="lightbox-img" src="">
    </div>



    <!-- Scripts -->
    <script src="../js/admin-guard.js"></script>
    <script src="../js/general.js"></script>
    <script src="admin-core.js"></script>
    <script src="admin-news.js"></script>
    <script src="admin.js"></script>

  </main>

</body>

</html>